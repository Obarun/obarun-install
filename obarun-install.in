#!/usr/bin/bash
# This script is under license BEER-WARE
# "THE BEER-WARE LICENSE" (Revision 42):
# <eric@obarun.org> wrote this file.  As long as you retain this notice you
# can do whatever you want with this stuff. If we meet some day, and you think
# this stuff is worth it, you can buy me a beer in return.   Eric Vidal
#
# Assumptions:
#  1) User has partitioned, formatted, and mounted partitions on a directory
#  2) Network is functional
#  3) A valid mirror appears in /etc/pacman.d/mirrorlist
#

##		Check is the functions file exits
sourcing(){
	
	local list
	
	for list in /usr/lib/obarun/{common_functions,install_functions} /etc/obarun/install.conf; do
		if [[ -f "${list}" ]]; then
			source "${list}"
		else
			echo_error " Missing file : ${list}"
			exit	
		fi
	done
	
	unset list
}
sourcing

shellopts_save
shellopts_set_unset "extglob" 0

##		Clean before exit

trap "clean_install" ERR QUIT KILL STOP INT TERM 

##		Must be root user 

(( EUID == 0 )) || die " ${bred}You must be run this script with root privileges" "clean_install"

##		Let's go

##		Update package or not

main_update(){
	echo_display " Do you want to update obarun-install package? [y|n]"

	reply_answer

	if (( ! $? )); then
		pac_update "obarun-install" "/var/lib/obarun/obarun-install" "$GIT_ADDR" || die " Impossible to update" "clean_install"
		source /usr/lib/obarun/install_functions
	else
		echo_retry " WARNING : Some functionalities will cannot works properly"
		echo_info " Press enter to continue"
		read enter
	fi
	
	echo_display " Do you want to update obarun-install-themes package? [y|n]"
	
	reply_answer

	if (( ! $? )); then
		pac_update "obarun-install-themes" "/var/lib/obarun/obarun-install-themes" "https://github.com/Obarun/obarun-install-themes.git" || die " Impossible to update" "clean_install"
	else
		echo_retry " WARNING : Some configurations can be out of date"
		echo_info " Press enter to continue"
		read enter
	fi
}

if [[ "$UPDATE" == "yes" ]]; then
	main_update
fi

main_menu




